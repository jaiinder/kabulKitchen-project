"use strict";define("fileUploader/components/fileUploader",["santaProps","lodash","reactDOM","core","textCommon","siteUtils"],function(e,i,t,s,o,n){function a(e){return{value:i.get(e,["selectedFiles"]),validity:i.get(e,["validity"])}}var l=s.compMixins,p=e.Types,r=n.fileUploadManager;return{displayName:"FileUploader",mixins:[l.skinBasedComp,o.textScaleMixin,l.compStateMixin(a),s.compMixins.inputFocusMixin],statics:{useSantaTypes:!0,behaviors:{behaviors:i.assign({change:{methodName:"validate"}},s.compMixins.inputFocusMixin.INPUT_FOCUS_BEHAVIORS)}},propTypes:i.assign({compData:e.Types.Component.compData.isRequired,compProp:e.Types.Component.compProp.isRequired,siteMediaToken:p.RendererModel.siteMediaToken.isRequired,windowKeyboardEvent:e.Types.SiteAspects.windowKeyboardEvent.isRequired,getMediaFullStaticUrl:e.Types.ServiceTopology.getMediaFullStaticUrl,shouldResetComponent:e.Types.RenderFlags.shouldResetComponent.isRequired}),getInitialState:function(){return{selectedFiles:[],promiseCallback:void 0,uploading:!1,validity:{valid:!0,validationMessage:""}}},componentDidMount:function(){this.props.windowKeyboardEvent.registerToKeyDownWithFocus(this,this.refs.chooseFileButton)},componentWillReceiveProps:function(e){e.shouldResetComponent&&(this.setState({validity:{valid:!0,validationMessage:""}}),this.removeFile())},onKeyDown:function(e){var t=[13,32];if(!this.props.compProp.isDisabled&&i.includes(t,e.keyCode)){var s=i.includes(e.target.className,"chooseFileButton"),o=i.includes(e.target.classList[0],"uploadName");s?(this.refs.fileInput.click(),this.refs.chooseFileButton.blur()):o&&this.removeFile()}},focus:function(){this.refs.chooseFileButton.focus()},blur:function(){this.refs.chooseFileButton.blur()},createFileNodes:function(e){var t=this.props.compProp.showPlaceholder,s=this.props.compProp.filesAlignment,o=this.props.compData.placeholderLabel,n=i.cloneDeep(this.state.selectedFiles),a={isPlaceholder:!!i.isEmpty(n)&&t,alignment:s,previewState:e,errorState:!this.state.validity.valid,removeFunction:this.removeFile,scale:i.get(this.props,"structure.layout.scale"),uploading:this.state.uploading};return i.isEmpty(n)&&(i.isUndefined(e)?(o=""===o?" ":o,n.push({name:o}),t&&" "!==o||(a.hidePlaceholder=!0)):(n.push({name:"Example.txt"}),a.isPlaceholder=!1)),i.map(n,function(e,i){return this.createChildComponent({id:"uploadName"+i,fileName:e.name},"wysiwyg.viewer.components.inputs.uploadName","uploadName",a)}.bind(this))},removeFile:function(){this.state.uploading||this.setState({selectedFiles:[]},function(){t.findDOMNode(this.refs.fileInput).value="",this.handleAction(n.constants.ACTION_TYPES.CHANGE)}.bind(this))},finishUpload:function(e,i,t){this.state.promiseCallback&&this.state.promiseCallback(e,i);var s=i?i.errorDescription:"";this.setState({promiseCallback:void 0,uploading:!1,validity:{valid:t,validationMessage:s}},function(){t&&this.removeFile()})},uploadCompleteCB:function(e){var i=e[0];"Image"===this.props.compProp.filesType&&(i.uri=i.file_name,i.title=i.file_name),this.finishUpload(e[0],null,!0)},uploadFailedCB:function(e){var i={errorCode:e.error_code,errorDescription:e.error_description};this.finishUpload(null,i,!1)},uploadFiles:function(e){this.validate()&&this.state.selectedFiles.length>0&&!this.state.uploading&&this.setState({promiseCallback:e,uploading:!0},function(){i.forEach(this.refs.fileInput.files,function(e){r.uploadFile(e,this.props.siteMediaToken,this.props.compProp.filesType,this.uploadCompleteCB,this.uploadFailedCB)}.bind(this))}.bind(this))},validate:function(){var e=!this.props.compProp.required||!i.isEmpty(this.state.selectedFiles),t=e?"":"Must have file to upload";return this.setState({validity:{valid:e,validationMessage:t}},function(){this.handleAction(n.constants.ACTION_TYPES.VALIDATE)}),e},onFileSelectionChange:function(){if(this.refs.fileInput.files.length>0){var e=i.map(this.refs.fileInput.files,function(e){return{name:e.name,size:e.size}});this.setState({selectedFiles:e},function(){this.handleAction(n.constants.ACTION_TYPES.CHANGE),this.validate()})}},getAcceptableFileTypes:function(){switch(this.props.compProp.filesType){case"Image":return".jpeg,.png,.jpg";case"Document":return".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.odp,.odt,.epub"}},handleButtonFocus:function(e){this.handleAction(n.constants.ACTION_TYPES.FOCUS,e)},handleButtonBlur:function(e){this.handleAction(n.constants.ACTION_TYPES.BLUR,e)},getSkinProperties:function(){var e=this.props.compData,i=this.props.compProp,t={};t[i.buttonAlignment]=!0,t["no-label"]=""===e.buttonLabel;var s=this.getComponentPreviewState()||this.props.previewState,o=!!this.props.compProp.isDisabled||this.state.uploading,n=!this.state.validity.valid;return{"":{},chooseFileButton:{className:this.classSet(t),onClick:function(){o||(this.refs.fileInput.click(),this.refs.chooseFileButton.blur())}.bind(this),onFocus:o?null:this.handleButtonFocus,onBlur:o?null:this.handleButtonBlur,"data-preview":s,"data-disabled":o,"data-error":n},buttonLabel:{children:[e.buttonLabel],style:this.getFontSize("btn_fnt")},fileInput:{onChange:this.onFileSelectionChange,accept:this.getAcceptableFileTypes()},files:{children:this.createFileNodes(s),"data-preview":s}}}}}),define("fileUploader/components/uploadName",["santaProps","react","lodash","core","textCommon"],function(e,i,t,s,o){return{displayName:"UploadName",mixins:[s.compMixins.skinBasedComp,o.textScaleMixin],statics:{useSantaTypes:!0},propTypes:t.assign({compData:e.Types.Component.compData.isRequired,compProp:e.Types.Component.compProp.isRequired,alignment:i.PropTypes.string.isRequired,removeFunction:i.PropTypes.func.isRequired,isPlaceholder:i.PropTypes.bool.isRequired,scale:i.PropTypes.number.isRequired,previewState:i.PropTypes.string,errorState:i.PropTypes.bool,uploading:i.PropTypes.bool,windowKeyboardEvent:e.Types.SiteAspects.windowKeyboardEvent.isRequired}),componentDidMount:function(){var e=this.props.id.split("uploadName")[0];this.props.windowKeyboardEvent.registerToKeyDownWithFocus({props:{id:e}},this.refs["x-icon"])},getSkinProperties:function(){var e=this.props.compData,i={};i["align-"+this.props.alignment]=!0,i["hide-placeholder"]=this.props.hidePlaceholder;var t=!!this.props.compProp.isDisabled||this.props.uploading,s=this.getComponentPreviewState()||this.props.previewState,o=this.props.errorState;return{"":{className:this.classSet(i),"data-preview":s},"x-icon":{style:this.props.isPlaceholder?{display:"none"}:{},onClick:function(){this.props.removeFunction&&!this.props.uploading&&this.props.removeFunction(e.fileName)}.bind(this),"data-preview":s,"data-disabled":t,"data-error":o},"file-name":{className:this.classSet({"file-name-placeholder":this.props.isPlaceholder}),children:[e.fileName],"data-preview":s,"data-disabled":t,"data-error":o,style:this.getFontSize("file_fnt",this.props.scale)}}}}}),define("fileUploader",["fileUploader/components/fileUploader","fileUploader/components/uploadName"],function(e,i){return{fileUploader:e,uploadName:i}});
//# sourceMappingURL=fileUploader.min.js.map